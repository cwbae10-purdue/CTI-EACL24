An official website of the United States government Here's how you know
This report is provided "as is" for informational purposes only.
The Department of Homeland Security (DHS) does not provide any warranties of any kind regarding any information contained herein.
The DHS does not endorse any commercial product or service referenced in this bulletin or otherwise.
This document is marked TLP:WHITE--Disclosure is not limited.
Sources may use TLP:WHITE when information carries minimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release.
Subject to standard copyright rules, TLP:WHITE information may be distributed without restriction.
For more information on the Traffic Light Protocol (TLP), see http://www.us-cert.gov/tlp.
This Malware Analysis Report (MAR) is the result of analytic efforts between the Cybersecurity and Infrastructure Security Agency (CISA), the Cyber National Mission Force (CNMF), and the Federal Bureau of Investigation (FBI).
The malware variant, known as ComRAT, has been used by Turla, a Russian-sponsored Advanced Persistent Threat (APT) actor.
CISA, CNMF, and FBI are distributing this MAR to enable network defense and reduced exposure to malicious activity.
This MAR includes suggested response actions and recommended mitigation techniques.
FBI has high-confidence that Russian-sponsored APT actor Turla, which is an espionage group active for at least a decade, is using ComRAT malware to exploit victim networks.
The group is well known for its custom tools and targeted operations.
This report analyzes a PowerShell script that installs a PowerShell script, which will decode and load a 64-bit dynamic-link library (DLL) identified as ComRAT version 4.
This new variant of ComRAT contains embedded 32-bit and 64-bit DLLs used as communication modules.
The communication module (32-bit or 64-bit DLL) is injected into the victim systemís default browser.
The ComRATv4 file and the communication module communicate with each other using a named pipe.
The named pipe is used to send Hypertext Transfer Protocol (HTTP) requests and receive HTTP responses to and from the communication module for backdoor commands.
It is designed to use a Gmail web interface to receive commands and exfiltrate data.
The ComRAT v4 file contains a Virtual File System (VFS) in File Allocation Table 16 (FAT16) format, which includes the configuration and logs files.
Users or administrators should flag activity associated with the malware and report the activity to the CISA or the FBI Cyber Watch (CyWatch), and give the activity the highest priority for enhanced mitigation.
For more information on malicious cyber activity, please visit https://us-cert.cisa.gov/
For a downloadable copy of IOCs, see: MAR-10310246-2.v1.WHITE.stix.
This file is a heavily encoded malicious PowerShell script.
It is designed to install a malicious PowerShell script into a registry on the victim system.
The primary purpose of the newly installed PowerShell is to decode and load a malicious DLL, identified as ComRat v4 (44d6d67b5328a4d73f72d8a0f9d39fe4bb6539609f90f169483936a8b3b88316) onto the victim's system.
This heavily encoded PowerShell script is installed by the malicious script “corrected.ps1” (134919151466c9292bdcb7c24c32c841a5183d880072b0ad5e8b3a3a830afef8).
It is designed to decode and load an embedded DLL which has been identified as a variant of the malware known as ComRat v4 “ComRATv4.exe (44d6d67b5328a4d73f72d8a0f9d39fe4bb6539609f90f169483936a8b3b88316).
Removal of some of the PowerShell obfuscation reveals the functions illustrated below.
The encoded PowerShell script contains an embedded function named “Run”, that can load a DLL directly from memory and inject it into a remote process (Figure 2).
The PowerShell script injects the embedded ComRAT DLL (44d6d67b5328a4d73f72d8a0f9d39fe4bb6539609f90f169483936a8b3b88316) into the Windows Explorer process.
Figure 1 - Screenshot of the payload embedded within this malicious script.
Figure 2 - Screenshot of the function used to load a DLL directly from memory and inject it into a remote process.
This application is a 32-bit Windows DLL that has been identified as a module of ComRAT v4.
The DLL is loaded into Windows Explorer (Explorer.exe) by a ComRAT PowerShell loader (a3170c32c09fc85cdda778a5c20a3dab144b6d1dd9996ba8340866e0081c7642).
When executed, it checks the victim's system day\time and it performs code execution between 9AM to 5PM Monday through Friday.
During execution, it installs the following files into the %TEMP% folder:
			--Begin files--
			"%TEMP%\iecache.bin" ==> an AES-256-XTS encrypted VFS FAT16 format, containing the malware configuration and the logs files.
(The encryption key is generated during runtime and stored in the Windows registry).
"%TEMP%\FSAPIDebugLogFile.txt
			--End files--
			The malware injects an embedded communication module (00352afc7e7863530e4d68be35ae8b60261fc57560167645697b7bfc0ac0e93d or (166b1fb3d34b32f1807c710aaa435d181aedbded1e7b4539ffa931c2b2cdd405) into the victim system's default browser and executes it.
This file and the communication module communicate with each other using a named pipe.
The malware uses the named pipe to send HTTP requests and receive HTTP responses to and from the communication module for backdoor commands.
It is designed to use the Gmail web interface to receive commands and exfiltrate data.
Illustrated below are sample data observed in the decrypted VFS in FAT16 format.
Some of these files can be updated in the VFS using backdoor commands.
"/etc/mail/subj_dict" contains the the Subject "Re: |RE: |FW: |FWD: | Fw: | Fwd:| FYI: |FYIP |NRN: | NT: | N/T | n/t| NB |NM| n/m |N/M: |*n/m*"
			"/etc/php_storage/GET/DEF/server.txt " and "/etc/php_storage/POST/DEF/server.txt" contains server IP "172.22.150.125".
--End sample data in the VFS --
Figure 3 - The first bytes of the decrypted VFS in FAT16 format.
Figure 4 - The decrypted VFS hierarchy, containing the malware configuration and the logs files.
This application is a 32-bit Windows DLL that has been identified as the communication module injected into the victim's system default browser by "ComRATv4.exe" (44d6d67b5328a4d73f72d8a0f9d39fe4bb6539609f90f169483936a8b3b88316).
It is designed to use the HTTP and a Gmail web interface for the C2.
It attempts to connect to its C2 using secure connections.
--Begin list of domains--
			bronerg.tk
			crusider.tk
			duke6.tk
			sanitar.ml
			wekanda.tk
			branter.tk
			--End list of domains--
			Displayed below is sample request header:
			--Begin header--
			CONNECT bronerg[.
No Whois record at the time of analysis.
This application is a 64-bit Windows DLL that has been identified as the communication module injected into the victim's system default browser by "ComRATv4.exe" (44d6d67b5328a4d73f72d8a0f9d39fe4bb6539609f90f169483936a8b3b88316).
The DLL is similar to the 32-bit communication module (00352afc7e7863530e4d68be35ae8b60261fc57560167645697b7bfc0ac0e93d).
CISA recommends that users and administrators consider using the following best practices to strengthen the security posture of their organization's systems.
Any configuration changes should be reviewed by system owners and administrators prior to implementation to avoid unwanted impacts.
Additional information on malware incident prevention and handling can be found in National Institute of Standards and Technology (NIST) Special Publication 800-83, "Guide to Malware Incident Prevention & Handling for Desktops and Laptops".
CISA continuously strives to improve its products and services.
You can help by answering a very short series of questions about this product at the following URL: https://www.cisa.gov/forms/feedback/
A Malware Initial Findings Report (MIFR) is intended to provide organizations with malware analysis in a timely manner.
In most instances this report will provide initial indicators for computer and network defense.
To request additional analysis, please contact CISA and provide information regarding the level of desired analysis.
A Malware Analysis Report (MAR) is intended to provide organizations with more detailed malware analysis acquired via manual reverse engineering.
To request additional analysis, please contact CISA and provide information regarding the level of desired analysis.
Can I edit this document?
This document is not to be edited in any way by recipients.
All comments or questions related to this document should be directed to the CISA at 1-888-282-0870 or CISA Service Desk.
Can I submit malware to CISA?
Malware samples can be submitted via three methods:
CISA encourages you to report any suspicious activity, including cybersecurity incidents, possible malicious code, software vulnerabilities, and phishing-related scams.
Reporting forms can be found on CISA's homepage at www.cisa.gov.
This product is provided subject to this Notification and this Privacy & Use policy.
We recently updated our anonymous product survey; we'd welcome your feedback.
Receive security alerts, tips, and other updates.
CISA is part of the Department of Homeland Security
