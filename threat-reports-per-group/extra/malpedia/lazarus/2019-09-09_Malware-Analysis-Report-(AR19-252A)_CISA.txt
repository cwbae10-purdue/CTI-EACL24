An official website of the United States government Here's how you know
This report is provided "as is" for informational purposes only.
The Department of Homeland Security (DHS) does not provide any warranties of any kind regarding any information contained herein.
The DHS does not endorse any commercial product or service referenced in this bulletin or otherwise.
This document is marked TLP:WHITE--Disclosure is not limited.
Sources may use TLP:WHITE when information carries minimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release.
Subject to standard copyright rules, TLP:WHITE information may be distributed without restriction.
For more information on the Traffic Light Protocol (TLP), see http://www.us-cert.gov/tlp.
This Malware Analysis Report (MAR) is the result of analytic efforts between the Department of Homeland Security (DHS), the Federal Bureau of Investigation (FBI), and the Department of Defense (DoD).
Working with U.S. Government partners, DHS, FBI, and DoD identified Trojan malware variants used by the North Korean government - referred to by the U.S. Government as BADCALL.
The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA.
For more information on HIDDEN COBRA activity, visit https[:]//www[.
FBI has high confidence that HIDDEN COBRA actors are using malware variants in conjunction with proxy servers to maintain a presence on victim networks and to further network exploitation.
DHS, FBI, and DoD are distributing this MAR to enable network defense and reduce exposure to North Korean government malicious cyber activity.
This MAR includes malware descriptions related to HIDDEN COBRA, suggested response actions and recommended mitigation techniques.
Users or administrators should flag activity associated with the malware, report the activity to the DHS National Cybersecurity and Communications Integration Center (NCCIC) or the FBI Cyber Watch (CyWatch), and give the activity the highest priority for enhanced mitigation.
This report provides analysis of four (4) malicious executable files.
The first three (3) files are 32-bit Windows executables that function as proxy servers and implement a "Fake TLS" method similar to the behavior described in a previously published NCCIC report, MAR-10135536-B.
The fourth file is an Android Package Kit (APK) file designed to run on Android platforms as a fully functioning Remote Access Tool (RAT).
For a downloadable copy of IOCs, see:
This file is a malicious 32-bit Windows executable.
Analysis indicates this application is designed to force a compromised system to function as a proxy server.
When executed, the malware binds and listens for incoming connections on port 8000 of the compromised system.
The proxy session traffic is protected by way of a simple cipher based on rotating XOR and ADD.
The cipher will XOR each byte sent with 47h and added by 28h.
Each byte received by the malware will be XOR’ed by 47h and subtracted by 28h.
See Figures 1, 2 and 3 for code examples.
When the adversary initially connects to a victim’s machine via port 8000, the adversary must first authenticate (over a session secured with the XOR/ADD cipher described above) by providing the ASCII string "1qazXSDC23we”.
If the malware does not receive this value, it will terminate the session, responding with the value "m*^&^ghfge4wer”.
If the operator authenticates successfully, they can then issue the command "ghfghjuyufgdgftr" which instructs the malware to begin functioning as a proxy server and respond to the operator with the value "q45tyu6hgvhi7^%$sdf”.
Next, the malware attempts to create a proxy session between the operator and another server.
During this process, the malware will attempt to authenticate with the destination server by sending the value "ghfghjuyufgdgftr" as a challenge.
To complete the authentication sequence, the malware expects to receive a response value of "q45tyu6hgvhi7^%$sdf".
All challenge and response traffic is encoded using the ADD/XOR cipher described earlier.
The proxy session begins with a remote operator connecting to this implant via a "fake TLS" connection attempt, similar to the behavior described in a previously released NCCIC report, MAR-10135536-B.
Essentially, the malware initiates the TLS session using one of several public SSL certificates obtained from well known, legitimate internet services and embedded in the malware.
However, the traffic from the operator to this implant is not protected with SSL / TLS encryption.
The traffic is only protected via the ADD/XOR cipher embedded within this implant (see Figure 2-3.).
If the remote operator authenticates correctly as detailed above, the implant attempts to begin a proxy session with the remote target system.
The traffic to the remote systems from this implant are sent and received via the SSL_read and SSL_write APIs available in OpenSSL.
However, the malware does not appear to attempt to load an SSL private key or certificate.
The malware contains public SSL certificates for the following list of domains, which are used for initiating the "fake TLS" session:
			--Begin SSL Certificate Strings--
			myservice.xbox.com
			uk.yahoo.com
			web.whatsapp.com
			www[.
]wikipedia.org
			--End SSL Certificate Strings--
This file is a malicious 32-bit Windows DLL.
Static analysis indicates this application is very similar in structure and function to C6F78AD187C365D117CACBEE140F6230.
However, rather than being a PE32 executable this application is a Windows 32-bit DLL, which must be loaded by an external loader.
This external loader was not included within this submission.
This DLL is designed to force a compromised system to act as a proxy server.
This implant is designed to proxy network traffic from an operator to another software tool that is being operated by the adversary on a remote system.
The traffic to and from this proxy server will be protected with the same simple XOR / ADD cipher used by the malware C6F78AD187C365D117CACBEE140F6230.
Static analysis indicates sessions from the remote operator connecting directly to this implant will be protected via SSL / TLS, however the proxy sessions to the remote systems will not be protected via TLS but will instead use a "fake TLS" session.
The traffic from the operator to this implant and traffic from the implant to the remote systems will be protected via the embedded XOR / ADD cipher (view screenshot).
To implement SSL with the remote operator, the malware loads a private key from a file named 'wbemhost.dll' and a certificate from a file named 'netconf.dll'.
This malware does not drop either of these files (see Figure.
Analysis of this malware indicates it is designed to bind to and listen for incoming connections to the victim’s system after disabling the firewall by modifying the following registry key.
The firewall is disabled by allowing incoming access on port 443.
This malware also has the added capability of allowing an operator to collect information about the compromised system.
This information is collected using the Windows APIs GetComputerNameW, gethostbyname, and GetAdaptersInfo.
In order to use this feature, the operator must issue the instruction value "ghfghjuyufgdgftr” after authenticating.
As with C6F78AD187C365D117CACBEE140F6230, this malware uses the OpenSLL functions ssl_read() and ssl_write() to exchange data with the operator, however the malware additionally uses a simple XOR cipher (as earlier described) to decrypt incoming traffic.
Analysis indicates this malware must also authenticate with the destination server to which the operator wishes to proxy traffic.
To do so, this malware first sends that remote server the challenge value "1qazXSDC23we."
The malware must then receive the following response from the destination server before it will allow the operator to proxy traffic to it: "m*^&^ghfge4wer” (see Figure 6).
The authentication values sent to and from this proxy server will be protected via the same XOR / ADD cipher utilized by the malware C6F78AD187C365D117CACBEE140F6230 (see Figures 8-9).
The following is a list of the domains for which the malware contains public SSL certificates, used for initiating the "FAKE TLS" sessions:
			--Begin SSL cert list--
			myservice.xbox.com
			uk.yahoo.com
			web.whatsapp.com
			www[.
]wikipedia.org
			--End SSL cert list--
This file is a 32-bit Windows DLL.
This file is an implant loader for a DLL and is designed to be called from the ServiceMain export function.
The malware attempts to decrypt an embedded chunk of data that is 50896 bytes in size.
This decryption is performed utilizing an RC4 algorithm.
The key used for this decryption is displayed below:
			--Begin RC4 Key--
			CC E5 71 D9 B5 88 9D 53 EF 74 D1 9A E5 A4 1E B3
			--End RC4 Key--
			This decrypted file is a zip file which contains a malicious DLL file named 'z' (2733A9069F0B0A57BF9831FE582E35D9).
This file is a zip compressed archive that was extracted from the file 22082079AB45CCC256E73B3A7FD54791.
The zip file contains the malicious DLL 'z' (2733a9069f0b0a57bf9831fe582e35d9).
This file is a 32-bit DLL file.
Static analysis indicates this application is very similar in structure and function to C6F78AD187C365D117CACBEE140F6230.
This DLL is designed to force a compromised system to act as a proxy server.
This implant is designed to proxy network traffic from an operator to another software tool that is being operated by the adversary on a remote system.
The traffic to and from this proxy server will be protected with the same simple XOR / ADD cipher used by the malware C6F78AD187C365D117CACBEE140F6230.
Static analysis indicates the OpenSSL library is used to implement a TLS/SSL initialization between the operator and this implant.
The malware will also use a rotating XOR / ADD cipher to secure communications from the remote operator -- in addition to the SSL encryption.
During this initialization process the malware loads a private key from a file named 'wbemhost.dll' (see Figure 11.)
and a certificate from a file named 'netconf.dll'.
The malware does not drop these two files, therefore it is expected to be already dropped on the system using another method.
The malware binds and listens for C2 sessions on the victim's system (see Figure 12.).
Once a C2 session is received on a binded port the malware will read the data by using the OpenSSL library and will decode it using a simple rotating XOR / ADD cipher.
After decrypting the incoming traffic the implant ensures it contains the following authentication value:
			--Begin Auth Value--
			qwertyuiop
			--End Auth Value--
			If the authentication value exists, the implant knows the external operator wants to proxy traffic through to another location.
The malware will respond with the XOR / ADD encoded value "asdfghjkl" to let the operator know it is ready to proceed with the proxy requests.
Static analysis indicates the malware will connect to remote proxy servers via the Fake TLS protocol mentioned in prior analysis.
SSL encryption will not be used to secure communications between this implant and the remote proxy servers -- it will simply use its embedded XOR / ADD cipher (view screenshot).
The malware notifies the remote proxy server it wants to open a session by sending it the value "1qazXSDC23we".
It then expects the remote proxy server to respond with the value "m*^&^ghfge4wer".
If the remote proxy server does not respond with this value, the proxy session will not continue.
Analysis indicates the malware also contains a large structure capable of gathering a great deal of information about the victim's system including the computer named and attached adapters.
Static analysis indicates all network traffic received and sent from this implant will be protected via a rotating XOR / ADD cipher.
Additionally, the connection to the binded port by the C2 operator will be protected via SSL encryption.
Whereas, the connections to the remote hosts (accessed via a proxy session) will be protected only via the cipher mentioned above (see Figures 14-15.
This file is a malicious Android APK file.
Static analysis indicates it is a RAT, which is designed to listen for incoming connections to a compromised Android device, on port 60000.
Analysis indicates the Android app is capable of recording phone calls, taking screenshots using the device's embedded camera, reading data from the device's contact manager, and downloading and uploading data from the compromised Android device.
The application is also capable of executing commands on the compromised system and scanning for open Wi-Fi channels.
CISA recommends that users and administrators consider using the following best practices to strengthen the security posture of their organization's systems.
Any configuration changes should be reviewed by system owners and administrators prior to implementation to avoid unwanted impacts.
Additional information on malware incident prevention and handling can be found in National Institute of Standards and Technology (NIST) Special Publication 800-83, "Guide to Malware Incident Prevention & Handling for Desktops and Laptops".
CISA continuously strives to improve its products and services.
You can help by answering a very short series of questions about this product at the following URL: https://us-cert.gov/forms/feedback/
A Malware Initial Findings Report (MIFR) is intended to provide organizations with malware analysis in a timely manner.
In most instances this report will provide initial indicators for computer and network defense.
To request additional analysis, please contact CISA and provide information regarding the level of desired analysis.
A Malware Analysis Report (MAR) is intended to provide organizations with more detailed malware analysis acquired via manual reverse engineering.
To request additional analysis, please contact CISA and provide information regarding the level of desired analysis.
Can I edit this document?
This document is not to be edited in any way by recipients.
All comments or questions related to this document should be directed to the CISA at 1-888-282-0870 or soc@us-cert.gov.
Can I submit malware to CISA?
Malware samples can be submitted via three methods:
CISA encourages you to report any suspicious activity, including cybersecurity incidents, possible malicious code, software vulnerabilities, and phishing-related scams.
Reporting forms can be found on CISA's homepage at www.us-cert.gov.
This product is provided subject to this Notification and this Privacy & Use policy.
We recently updated our anonymous product survey; we'd welcome your feedback.
Receive security alerts, tips, and other updates.
CISA is part of the Department of Homeland Security
