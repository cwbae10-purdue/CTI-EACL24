
=== Mar 17, 2019 ===
This is Part 1 of Emotet malware analysis I’m planning to post.
It covers phases 1 and 2 of the attack, specifically phishing and establishing persistence in the infected system.
Emotet is spread via phishing emails containing malicious links or attachments, and targets everyone (individuals, companies and governments).
First phase of the attack starts with a Phishing email.
Usually subject, layout, attachments and links are modified periodically by attackers.
In this article I’m going to analyze this sample from VirusTotal.
One of Emotet’s characteristics is constantly changing content of the phishing emails.
Usually these contain a malicious link or attachment.
This article covers the sample which was spread using via following links:
All URLs above, once accessed, drop a Microsoft Office Document with macros in it.
Based on the result we get by running file command against this sample, it looks like this document has 1 page and doesn’t contain any words.
Using Oletools to get the list of document’s objects, 3 macros elements have been found:
Objects 8, 9 and 16 contain Visual Basic code, thus of higher interest for further analysis.
Out of all extracted parts of the script, mA4QAX4 is the entry point and starts the execution once the document is opened.
Whole VBS code is obfuscated, as seen in the image below.
All three parts are dependent on each other and have to be merged, for further analysis.
You can find it HERE.
The call chain looks like this:
Value of param consists of concatenated results of following functions: SQoBUAA, vDXBUQ, rDCAQQcA, pAADAADD, k1kGUAB, cAABQDw.
All these functions are similar in terms of logic and were easy to de-obfuscate.
Below is the clean version of SQoBUAA:
A base64 encoded powershell script is extracted and set to run at system’s startup, by the document macros.
Once decoded, several URLs pop up which drop phase 3 PE files.
Totally there are 5 different websites, hosting Emotet malware.
Looks like the group behind Emotet, haven’t focused on heavily obfuscating phase 1 and 2 scripts.
Analysis of downloaded samples to follow in Part 2 of this article.
Find me on:
Twitter
GitHub
LinkedIn
YouTube
Email
