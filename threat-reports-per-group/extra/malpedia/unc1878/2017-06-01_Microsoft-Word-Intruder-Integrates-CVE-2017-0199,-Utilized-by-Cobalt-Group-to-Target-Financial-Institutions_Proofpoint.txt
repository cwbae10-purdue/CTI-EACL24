Defend against threats, ensure business continuity, and implement email policies.
Protect against email, mobile, social and desktop threats.
Engage your users and turn them into a strong line of defense against phishing and other cyber attacks.
Defend against cyber criminals accessing your sensitive data and trusted accounts.
Reduce risk, control costs and improve data visibility to ensure compliance.
Protect from data loss by negligent, compromised, and malicious users.
Protect against digital security risks across web domains, social media and the deep and dark web.
Get deeper insight with on-call, personalized assistance from our expert team.
  Get real-time insight into threats that can cause data loss and brand damage.
Protect your people from email and cloud threats with an intelligent and holistic approach
Help your employees identify, resist and report attacks before the damage is done
Prevent data loss via negligent, compromised and malicious insiders by correlating content, behavior and threats
Manage risk and data retention needs with a modern compliance and archiving solution
Keep your people and their cloud apps secure by eliminating threats, avoiding data loss and mitigating compliance risk
Implement the very best security and compliance solution for your Microsoft 365 collaboration suite
Secure access to corporate resources and ensure business continuity for your remote workers
Deliver Proofpoint solutions to your customers and grow your business.
Learn about the benefits of becoming a Proofpoint Extraction Partner.
Learn about our global consulting and services partners that deliver fully managed and integrated solutions.
Learn about our relationships with industry-leading firms to help protect your people, data and brand.
Learn about the technology and alliance partners in our Social Media Protection Partner program.
Small Business Solutions for channel partners and MSPs.
Find the information you're looking for in our library of videos, data sheets, white papers and more.
Keep up with the latest news and happenings in the ever‑evolving cybersecurity landscape.
Learn about the human side of cybersecurity.
Episodes feature insights from experts and executives.
Learn about the latest security threats and how to protect your people, data, and brand.
Connect with us at events to learn how to protect your people and data from ever‑evolving threats.
Read how Proofpoint customers around the globe solve their most pressing cybersecurity challenges.
Browse our webinar library to learn about the latest threats, trends and issues in cybersecurity.
Learn about our threat operations center and read about the latest risks in our threat blog and reports.
Proofpoint is a leading cybersecurity company that protects organizations' greatest assets and biggest risks: their people.
Today’s cyber attacks target people.
Learn about our unique people-centric approach to protection.
Stand out and make a difference at one of the world's leading cybersecurity companies.
Read the latest press releases, news stories and media highlights about Proofpoint.
Access the full range of Proofpoint support services.
In May, Proofpoint observed multiple campaigns using a new version of Microsoft Word Intruder (MWI).
MWI is a tool sold on underground markets for creating exploit-laden documents, generally used in targeted attacks.
We previously reported about MWI when it added support for CVE-2016-4117 [2].
After the latest update, MWI is now using CVE-2017-0199 [4][5] to launch an HTML Application (HTA) used for both information collection and payload execution.
This activity targets organizations in the financial vertical including banks, banking software vendors, and ATM software and hardware vendors.
The emails are sent to technology and security personnel working in departments including Fraud and Information Security.
The actor involved is believed to be the Cobalt group -- an actor known to target banks in Europe and Asia and previously documented by Group IB [1].
The malicious documents created with MWI for use in these activities delivered Metasploit Stager, Cobalt Strike, and previously undocumented malware we named Cyst Downloader.
While we observed numerous malicious attachments, we describe two here and list the rest in the IOC section.
Figure 1: Email used to deliver the MWI document (Body translated: “Good day, important to familiarize yourself!”)
Figure 2: Email used to deliver the MWI document (Body translated: “Please accept following advice and recommendations regarding necessary safety precautions”)
Figure 3: MWI document after the exploit is triggered; the lure displays unreadable characters
Figure 4: MWI document after the exploit is triggered; the lure describes the different ways to pay for a delinquent MTS (Russian mobile provider) bill
MWI Advertising Integration of CVE-2017-0199
Before we describe our MWI analysis, it is worth mentioning that on May 8, 2017, an advertisement for MWI on an underground site stated that this exploit document builder integrated CVE-2017-0199, and was recruiting customers for several available seats.
The full version of the original Russian advertisement and its English translation follows:
When the document is opened, it drops the embedded payload into a temporary directory as is typical of RTFs with embedded objects[6].
Next, the CVE-2017-0199 exploit downloads and executes the HTA.
From our analysis, the purpose of the HTA is two-fold.
It is used to download and/or execute the payload as well as collect information about the infected machine.
Thus the advertisement description is accurate.
In the example analyzed here, shown in Figure 5, the MWI HTA is configured to run an executable payload embedded in the document, which was previously saved into the temporary directory when the recipient opened the document.
Note that the HTA could have alternatively been configured to download and run an executable, DLL, or a JScript/VBscript file.
It is also configured to collect and report information about the system, such as installed antivirus applications, running processes, and whether execution of the payload was successful.
Figure 5: Configuration section of the MWI HTA
As mentioned above, depending on how MWI is configured, it has different ways of executing the payload.
Figure 6 shows the code snippet used for executing EXE and DLL payloads.
There is also functionality for executing JScript/VBScript (Figure 7) and cmd/Powershell.
All three methods generate a section for the Command and Control (C&C) report letting the operator know if the execution was successful.
Figure 6: Portion of the HTA code responsible for running DLLs and Executables
Figure 7: Portion of the HTA code responsible for executing VBScript/Jscript
The information collection code is responsible for profiling the system.
It collects network details, operating system information, installed antivirus products, and running processes (see list below).
This collected information is encoded with base64 and sent it to its C&C server.
Figure 8: Section of the HTA responsible for collecting information about the system
Figure 9: Section of the HTA responsible for sending collected data
Figure 10: Function in the HTA used to send collected data
The payload installed most frequently by MWI was the Metasploit stager, which in turn downloaded Cobalt Strike.
The Metasploit stager [7] is used to stage additional malware and we often see it in penetration testing as well as real attacks.
Malware Payload: Cyst Downloader and Plugin
However, in at least in one case we observed an MWI document install a previously unknown malware (SHA256: af17a3b5bf4c78283b2ee338ac6d457b9f3e7b7187c7e9d8651452b78574b3d3).
We are calling it the Cyst Downloader.
The functionality of this loader is limited.
It can create a mutex such as “syst<10 digits>” and communicate with the the C&C server to receive a DLL plugin.
The URI path pattern of the C&C beacon contains a folder (random alphanumeric name) followed by a file (random alphanumeric name) with a .jpg, .php, .gif, or .png extension.
The downloaded DLL is encrypted with a hardcoded "\x28\xBF\x0A\xBE\x5B\x6E\x70\x03" RC4  key and base64 encoded.
The server sends the DLL in HTML comments in a fake 404 response.
Figure 11: Cyst Downloader communicating with the C&C and receiving a payload plugin
The DLL plugin is loaded in memory by the loader and does not access the disk.
This plugin has the internal name “test.dll”, which may indicate it is still in development.
This plugin has only one export named “Execute”, which is hardcoded into the Cyst loader.
The plugin enumerates URLs stored in the browser history, with support for Internet Explorer, Chrome, Firefox, and Opera:
These methods of browser history parsing are well-known and have been used for a long time by malware authors.
The visited URLs retrieved are stored in malware memory using this format :
"browser: (IE|Chrome|Firefox|Opera)\r\n” + “url: %s” + " | time: %d\r\n"
Figure 12: Example of visited URLs (recovered from browser history) stored in memory
This data is then RC4 encrypted and sent to the same C&C.
The attacker is likely parsing the data on the server side and searching for a set of selected domains relevant to their attack, making it an efficient filter for interesting targets.
Microsoft Word Intruder is a powerful tool for creating exploit documents that can be used in a variety of malicious campaigns.
In this case, not only was it used to install known malware and customizable scripts and executables, but also installed a previously undocumented malware called Cyst Downloader.
While exploit documents are less commonly used in attacks as malicious attachments and hosted files than macro documents, the availability of often unpatched vulnerabilities like CVE-2017-0199 make it attractive to threat actors.
We will continue to monitor MWI development and campaigns by Cobalt and other actors using associated exploit documents.
Special thanks to our colleague Andrew Komarov (InfoArmor Inc.) for his help in this study.
Cyst Plugin (browser history checker)
ET and ETPRO Suricata/Snort Coverage
2024306          ET TROJAN MWI Maldoc Load Payload
2024197          ET CURRENT_EVENTS SUSPICIOUS MSXMLHTTP DL of HTA (Observed in RTF 0-day )
2024307          ET TROJAN MWI Maldoc Posting Host Data
2814013          ETPRO TROJAN Meterpreter or Other Reverse Shell SSL Cert
2023629          ET INFO Suspicious Empty SSL Certificate - Observed in Cobalt Strike
2826544          ETPRO TROJAN Cyst Downloader Fake 404
Subscribe to the Proofpoint Blog
Terms and conditions
Privacy Policy
Sitemap
