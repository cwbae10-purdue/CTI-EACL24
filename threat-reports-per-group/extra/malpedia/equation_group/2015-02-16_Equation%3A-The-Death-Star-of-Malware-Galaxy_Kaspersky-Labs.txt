Download “Equation group: questions and answers” PDF
One sunny day in 2009, Grzegorz  Brzęczyszczykiewicz1 embarked on a flight to the burgeoning city of Houston to attend a prestigious  international scientific conference.
As a leading scientist in his field, such  trips were common for Grzegorz.
Over the next couple of days, Mr Brzęczyszczykiewicz  exchanged business cards with other researchers and talked about  the kind of important issues such high level  scientists would discuss (which is another way of saying “who knows?”).
But, all good things must come to an end; the  conference finished and Grzegorz Brzęczyszczykiewicz flew back home, carrying  with him many highlights from a memorable event.
Sometime later, as is  customary for such events, the organizers sent all the participants a CDROM carrying  many beautiful pictures from the conference.
As Grzegorz put the CDROM in his  computer and the slideshow opened, he little suspected he had just became the victim  of an almost omnipotent cyberespionage organization that had just infected his  computer through the use of three exploits, two of them being zero-days.
It is not known when the Equation2 group began their ascent.
Some of the earliest malware samples we have seen  were compiled in 2002; however, their C&C was registered in August 2001.
Other C&Cs used by the Equation group appear to have been registered as  early as 1996, which could indicate this group has been active for almost two  decades.
For many years they have interacted with other powerful groups, such  as the Stuxnet and Flame groups; always from a position of superiority, as they  had access to exploits earlier than the others.
The #EquationAPT group is probably one of the most sophisticated cyber attack groups in the world #TheSAS2015
Since 2001, the Equation group has been  busy infecting thousands, or perhaps even tens of thousands of victims  throughout the world, in the following sectors:
To infect their victims, the Equation group  uses a powerful arsenal of “implants” (as they call their Trojans), including  the following we have created names for: EQUATIONLASER, EQUATIONDRUG,  DOUBLEFANTASY, TRIPLEFANTASY, FANNY and GRAYFISH.
No doubt other “implants”  exist which we have yet to identify and name.
The #EquationAPT group interacted with other powerful groups, such as the #Stuxnet and #Flame groups #TheSAS2015
The group itself has many codenames for  their tools and implants, including SKYHOOKCHOW, UR, KS, SF, STEALTHFIGHTER,  DRINKPARSLEY, STRAITACID, LUTEUSOBSTOS, STRAITSHOOTER, DESERTWINTER and GROK.
Incredible as it  may seem for such an elite group, one of the developers made the unforgivable  mistake  of leaving his username: “RMGREE5“,  in one of the malware samples as part of his working folder: “c:\users\rmgree5\“.
Perhaps the most powerful tool in the Equation group’s arsenal is a mysterious  module known only by a cryptic name: “nls_933w.dll“.
It allows them to reprogram the hard  drive firmware of over a dozen different hard drive brands, including  Seagate, Western Digital, Toshiba, Maxtor and IBM.
This is an astonishing  technical accomplishment and is testament to the group’s abilities.
Over the past years, the Equation group has  performed many different attacks.
One stands  out: the Fanny worm.
Presumably  compiled in July 2008, it was first observed and blocked by our systems in  December 2008.
Fanny used two zero-day  exploits, which were later uncovered during the discovery of Stuxnet.
To  spread, it used the Stuxnet LNK exploit and USB sticks.
For escalation of  privilege, Fanny used a vulnerability patched by the Microsoft bulletin MS09-025, which was also used in one of  the early versions of Stuxnet from 2009.
LNK exploit as used by Fanny
It’s important to point out that these two  exploits were used in Fanny before they  were integrated into Stuxnet, indicating that the Equation group had access  to these zero-days before the Stuxnet  group.
The main purpose of Fanny was the mapping  of air-gapped networks.
For this, it used a unique USB-based command and  control mechanism which allowed the attackers to pass data back and forth from  air-gapped networks.
Two zero-day exploits were used by the #EquationAPT group before they were integrated into #Stuxnet #TheSAS2015
In the coming days, we will publish more  details about the Equation group malware and their attacks.
The first document  to be published will be a general FAQ on the group together with indicators of  compromise.
By publishing this information, we hope to  bring it to the attention of the ITSec community as well as independent  researchers, who can extend the understanding of these attacks.
The more we  investigate such cyberespionage operations, we more we understand how little we  actually know about them.
Together, we can lift this veil and work towards a  more secure (cyber-)world.
Download “Equation group: questions and answers” PDF
1 pseudonym, to protect the original victim’s identity >>
2 the name “Equation group” was given because of their preference for sophisticated encryption schemes >>
Equation: The Death Star of Malware Galaxy
Your email address will not be published.
Required fields are marked *
 Save my name, email, and website in this browser for the next time I comment.
Notify me when new comments are added.
Ok, reading through NSA files that Der Spiegel released i found this:
This is a file that shows the job postings for NSA interns, you can find a NSA wiki link in the last page.
And this is very interesting:
(TS//SI//REL) Create a covert storage product that is enabled from a hard drive firmware modification.
The ideia would be to modify the firmware of a particular hard drive so that it normally only recognizes half of its available space.
It would report this size back to the operating system and not provide any way to access the additional space.
This is a 2006 document, it took 8 years to finish this product, which is what kaspersky found.
So maybe you guys would easily find the malware if you revert the firmware to a state prior of this date.
Firmware – definitely it’s something what AV should start to scan / check.
Yes it’s not easy task but absolutely needed to provide protection.
Firmware modifications- to verify if we have version in 100% confirmed by vendor.
I’ve read that most hard drive firmware is write-only
I think you may have got that backward.
But it’s wrong either way.
The whole point of this is that they (NSA) have worked out how to re-write the HDD firmware, which is usually just about impossible.
Then it is read every time the disk is used, if they want.
Your AV can’t see it, & it wouldn’t shock me if they had figured out a secondary way to send the data out.
In fact, if they’ve secretly halved the disc capacity they could just store the unencrypted data on the half you can’t delete!
We can use the whole HD.
There is a percentage of the HD that is not usable.
Perhaps the NSA hides out (Or could hide out) in that unusable space?
The problem comes from the fact there’s a standardized API to write the firmware but no API to read it.
This means we can’t easily check if a HDD has been compromised.
Several suggested solutions from our side include: firmware signing and checking on the disk side, firmware write-protect switch on the HDD and the ability to read the firmware easily and check for alterations.
I’m surprised someone like OnTrack or other companies that recover hard drives have not found items on this “empty space”.
Not really surprising when you think about it.
If the world-wide infection rate is in the 10’s of thousands, then lets assume that 10,000 of those are in the US, where data recovery is most prevalent.
If that’s the case, then there would still only be about a 0.004% chance of a particular machine being infected.
If we roll that to oh say 1 in 100 which is EXTREMELY low, then you’re now looking at a 0.00004% chance or about a 1 in 2.5million, that a DRS service would even lay their hands on an infected device.
Then… they have to actually notice it.
Can Kaspersky give a timeline of discoveries?
Where you aided by the discovery of BadUSB?
If Kroll OnTrack ever did run across this, they probably wouldn’t report it.
They are a DoD cleared contractor and are used to recover data from damaged classified hard drives.
Maybe you never heard about Rakshasa malware: http://www.extremetech.com/computing/133773-rakshasa-the-hardware-backdoor-that-china-could-embed-in-every-computer
It can hide himself also in your graphic card bios and, most important, it CANNOT BE REMOVED.
I wonder what the situation on Linux is.
Obviously the new firmware will only be controlled by a windows only stack of exploits even in a dual boot situation , but is Kaspersky aware of any possible tampering of binary distributed packages in linux major distributions, so that an equivalent infection can act on a linux system ?
what is the probability of that ?
I’ve thought that perhaps Linux’s main backdoor now is called “systemd” – since it’s VERY odd to see such rapid adoption of an unknown package(s) curated/written/compiled by only a few people whose goals are not clear.
3 major Linux bases (Fedora, Debian, etc) the NSA etc only had to convince one of them to get a back door(s) included as a “dependency”  and now, poof, you have the same problem as Windows in loading components you can’t completely check, an enlarged attack surface, and partially closed code.
Perhaps I am wrong, or slightly off as to where these backdoors are in Linux, but if I were a betting man then systemd is to me Linux’s downfall.
Roger, the kinds of targets tat Equation are aiming to infect (high-value data) are probably not the sorts of targets who will happily give up a hard drive containing high value data to companies such as OnTrack.
With only a few tens of thousands of infected targets globally, I’m not surprised that this has been secret until recently.
Low Value Target (but a target nonetheless)
I’m tired of running only zombies in this house.
Or at least help others avoid my own fate in the future.
Who can someone turn to, when you can’t even trust a search engine, e-mail provider, cell phone service, or the postal service anymore?
http://spritesmods.com/?art=hddhack
nsa isnt the only one capable of doing this sort of thing
Based on our experience, re-flashing the firmware doesn’t seem to always help.
There are certain areas in the firmware which do not get updated.
In another case, the firmware update didn’t work because it was “already the latest version”.
Yet another problem is that it’s not so healthy to keep reflashing the firmware every day and leave under a constant fear that it has been infected since the last re-flash.
I think we need reliable means to check if the firmware was compromised and better defense against such attacks instead of wearing down the ROM of your HDD.
You forgot moretimeads.com in the list of DoubleFantasy CnCs, although you sinkholed it yourself 😉
SHA256: a2a9e948fb829685d0a9161cac845fd0dfa943d023a6b2faab205fa8664b7c26
So if it’s based on Israel and the US’s prior malware, and it’s not directed against Israel but Islam, and nanotechnology, with all due respect, this is another Israel/US joint.
Therefore who is ultimately responsible?
Will the german people come back to the paper, pencil and rubber ?
Only time will tell !
Thx to K. Group for this research and result.
Flashed HDD firmware cannot typically be read.
Its a one-way action, so it is an obvious good place to hide malware.
I am interested in “Joey”‘s questions.
Who invented this suite, and as my old legal friends say, cui bono?
If this is another USA-Israel joint venture,  it would be useful and helpful to have proof, or at least some direct evidence.
We will be having an election soon in my country, and this sort of risk factor to our economy will be an election issue.
Most folks don’t care about security and spycraft issues until they are on the wrong side of a bad scenario.
But for folks who do care, they care deeply.
There is suspicion by some folks that our financial markets have been compromised by modern methods.
Information about this exploit makes it very clear that this concern is not idle fear.
I am skeptical of the idea that this comes from any government in particular.
For one, the coding is simply too smooth.
DoD, CIA, and NSA cyber-anything has lagged behind the civilian world since the 90s.
The coding was almost certainly a private entity operating under contract or from a private group of benefactors (the targeting of Iran despite the fickle nature of DC politics suggests another principle is at play).
The NSA also lacks the human intelligence resources to plant a virus on a commercial printing of CDs.
I contend that private entities have supplanted even the CIA in developing human intelligence and operator networks.
Such networks would also be easily capable of accessing government archives of source code samples.
The government rarely understands the market value of the things it so poorly secures after forcing them from companies.
The callback servers are easily operated and maintained by small private entities whose admins don’t even need to know what it is for.
The data retrieved is valuable to many different private entities.
Boeing, Sukhoi, Mikoyan-Greivich… any large defense contractor would be willing to pay for information related to the topography of a network or some of the data they are working on.
Remember when Lockheed suffered from the massive data breech related to the F-35?
Then the new super-sized F-35 China started playing with?
The recent ruling by the FCC is typical government intrusion – but the sudden nature of it, I would argue, is an attempt to get a hold on the call-back servers for these types of threats.
Though it may not be effective – it is classic government logic that I would argue indicates they are -not- in control of these groups and honestly have no idea how it is they are accomplishing what they are.
Further evidence can be supplied by a war-games trial run between the Active Duty Navy ITs and the Reserve-side ITs – who were civilian IT security, as well.
The Active duty didn’t even know what hit them – had no idea how they were compromised.
Obviously – it is mostly conjecture…
But if you look at the platform, it is a virtual “Sword of Damocles” – it can sit quietly on systems for years – giving information that is marketable while also giving the operator the ability to carry out “hits” for no additional cost.
If a customer is willing to pay to embed a virus – or someone else has a virus they wish for you to embed – then you have the perfect delivery platform.
A state tends to have a more results-driven approach – using operators to physically infect a system with a single objective.
Ten years is a -long- time in politics, and a project with a pay-off 8 years down the line gets the seating official 3 terms behind yours the cookie.
The more I look at it – the more this looks to be a business model.
Iran has no choice but to turn to outside IT sources like Kaspersky.
Boeing could be rife with this thing and we would never know it unless news of major data breaches get out (F-35 for Lockheed).
The Chinese are just as willing to pay to play as the U.S. is – or as Blackwater/XE is regarding a planned operation.
There is a lot more money to be made in cyber-espionage than the government has to waste on it.
Not to say that the government wouldn’t be interested in being a customer of such a business….
Very interesting thing to silently flash parts of a HDD firmware – I had a short peek into the circulating samples of EquationDrug and GrayFish.
I couldn’t find a place where stands “SAMSUNG” or “WDC” in any of these samples.
To be sure that I grabbed valid files I also looked for the string “GROK” in another sample and found it – so the collection seems valid …
So – what part of what sample is shown in the report on page 17 ?
Unlike the “GROK” string, the strings from NLS_933W are encrypted, so you’d have to decrypt them first.
We provide an MD5 for NLS_933W in the blog.
This report and the work you detail in the post are awesome achievements Costin; congrats to you and the team at Kaspersky.
Have you or Kaspersky Labs received any blowback from either the US government, or any organization, for making these revelations?
‘Holy Shit’ doesn’t begin to describe it.
Kaspersky is right, we need to band together to fight this.
Having  read this and further articles about Equation group, I made a  conclusion that the user computer security should be considered complexly from from the computer turning on to standard user actions in the operating system.
That is why I want to know answers on these 10 questions:
1.
Can usual antivirus check find all the harmful software of Equation Group family, if the check has tough options?
Can Equation group software patch system drivers, hard drive firmware and make other changes in OS booting when Secure boot is on and Kaspersky Internet Security with ELAM support is used?
If they can, are these changes fixed under question 2 conditions?
If the software acts successfully and no changes fixed by Secure boot or KIS, can TPM module fix them?
Do the components of Equation Group interact in the Oeration system environment or within internal family structure (directly between each other)?
Will new publications about the Grayfish and its main differences from the Equationdrug be?
Please give the list of hard drives models with changed firmware.
Can the core and components of the Equation Group mask themselves and other components to become unvulnerable for proactive defence and behavioral analysis?
This is about all the components and any antivirus or antispyware.
First of all I mean software control function of Kis or HIPS in the Comodo Internet Security.
What signs can be used to define the patching of the drive firmware exactly or with high possibility?
Can it be some files in the system or virtual file system?
Can the such software as 7datarecovery or other like it find such a virtual system?
Does Kaspersky Laboratory know about the development and implementation of the technologies complicating  the firmware patching by hard drives producers?
The hottest research right in your inbox
While investigating a recent rise of attacks against Exchange servers, we noticed a recurring cluster of activity that appeared in several distinct compromised networks.
With a long-standing operation, high profile victims, advanced toolset and no affinity to a known threat actor, we decided to dub the cluster GhostEmperor.
We discovered a campaign delivering the Tomiris backdoor that shows a number of similarities with the Sunshuttle malware distributed by DarkHalo APT and target overlaps with Kazuar.
This is our latest summary of advanced persistent threat (APT) activity, focusing on significant events that we observed during Q2 2021: attacks against Microsoft Exchange servers, APT29 and APT31 activities, targeting campaigns, etc.
We recently came across unusual APT activity that was detected in high volumes, albeit most likely aimed at a few targets of interest.
Further analysis revealed that the actor, which we dubbed LuminousMoth, shows an affinity to the HoneyMyte group, otherwise known as Mustang Panda.
The hottest research right in your inbox
© 2021 AO Kaspersky Lab.
Registered trademarks and service marks are the property of their respective owners.
The hottest research right in your inbox
