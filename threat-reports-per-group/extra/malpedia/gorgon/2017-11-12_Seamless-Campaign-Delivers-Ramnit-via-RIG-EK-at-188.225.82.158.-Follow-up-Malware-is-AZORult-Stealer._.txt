


 


				malwarebreakdown			
on
November 12, 2017
Note: I took a bit of break, but I will try to get back to posting more regularly.
Today’s infection chain is a familiar one as it includes the Seamless campaign delivering Ramnit banking Trojan via RIG exploit kit.
Below is an image of the infection chain, specifically the HTTP requests:
The infection chain starts off with a normal site and some ad traffic.
The HTTP request for ad traffic redirects to an XML feed serving ads.
The XML feed returned a 302 Found, pointing to hxxp://flinsheer-perreene[.
We then see a series of 3XX redirects:
/usa/ returns the following JavaScript, which POST information back to /usa/:
Further breakdown of the code can be seen HERE.
Typically, it would be at this point that unwanted connections would be filtered out and redirected to a benign site, however I didn’t run any further test for verification.
The server returns a 200 OK and points to the next step in the redirection chain via window.location.href=hxxp://flinsheer-perreene[.]com/voluum/cebddddb-0f28-4087-99c3-690fa79f4804?
The response to that request is shown below:
We see a meta refresh, redirecting to hxxp://kcsmj[.]redirectvoluum[.
]com:80/redirect?target=BASE64aHR0cDovLzE5NC41OC40MC4xOTMvdGVzdDIyLnBocA&ts=xxxxxxxxxxxxx&hash=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&rm=x after 0 seconds (bolded string in URI is Base64 encoded).
This redirect leads to another response containing one more meta refresh:
This meta refresh happens immediately, redirecting to hxxp://194[.]58[.]40[.
test22.php returns an iframe that contains the RIG EK landing page at 188.225.82.158:
After this long redirection chain, RIG EK finally delivers Ramnit banking Trojan.
The malware payload is placed in the user’s %TEMP% folder:
It also created a copy of itself in %LOCALAPPDATA%:
There is also a copy in %APPDATA%MicrosoftWindowsStart MenuProgramsStartup for persistence:
Modifies auto-execute functionality by setting/creating values in the registry:
After restarting the machine there are two more copies of the malware placed in %TEMP%:
There was also a copy in %TEMP%Low:
Entry for “Client” found in HKCUSoftwareAppDataLow:
Creates various .log files in %LOCALAPPDATA% and %PROGRAMDATA%:
If you looked at the %LOCALAPPDATA% image you might have noticed another executable file called “APITEM.EXE”.
This malware payload ended up being AZORult stealer and it was download by my infected host after the initial system restart.
Some .tempcbss files created by AZORult are located in %TEMP%:
After the system restart we could also see the DNS queries for Ramnit DGA domains:
Below is an image of the GET request for AZORult:
Note: Further analysis of the server delivering tutu.exe shows that it’s also hosting apis.exe and 1.exe.
1.exe was identified as Teamspy (aka TVRAT, TVSPY, and SpY-Agent) and apis.exe was identified as DarkVNC (Thanks to @Antelox for identifying the payloads).
tutu.exe was downloaded using the UA string “Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)”, which is Internet Explorer 6 on Windows XP SP2.
AZORult was placed in %LOCALAPPDATA% and executed.
Following the execution of the payload we see two POST requests:
Main page, passwords, and reports:
These threat actors have collected information on over 600+ victims in the last couple of days.
There are options for reporting, saved passwords (browsers, FTP, Email, and IM), Bitcoin client files, Skype db files, Steam files, Desktop files and CC.
The criminals are collecting and storing victim information in .zip files, named by the date and machine ID:
Information in the .zip file includes:
Due to security reasons, I will not be giving out certain samples to the public.
SHA256: be28a10416523b9ed143f99a1153f3530565a885c5b7dfa271ebad5a31ff0fb2
File name: RigEK 188.225.82.158 landing page.txt
SHA256: 4f8ee603630bbcc55b33b2c95347fe51d1dbc50531ece60b9f15050aa1119339
File name: RigEK 188.225.82.158 Flash exploit.swf
SHA256: 5c0a56406bd98c4da687fe7bc95d0d0ca271ad38bc394e8f6c4f5ef1c47277d7
File name: o32.tmp
SHA256: cc95870ebece2838ff9b2b8129386f015ea80d497a6c26127c9bd7abc588f2ea
File name: 1.exe
Hybrid-Analysis Report
SHA256: 35408635b78a61972dd48935fbbeb1fce067615c3cebf4498472252fbf893914
File name: apis.exe
Hybrid-Analysis Report
Artifacts from the infection and bonus malware samples.zip
Additional Reference for Ramnit:
https://www.cert.pl/news/single/ramnit-doglebna-analiza/ (original source)
https://www.cert.pl/en/news/single/ramnit-in-depth-analysis/ (English version)

			Just a normal person who spends their free time infecting systems with malware.
View all posts by malwarebreakdown
[…] Not surprisingly, the Seamless Campaign is still using RIG EK to deliver Ramnit banking Trojan.
Often times I find that it also downloads AZORult.
Fill in your details below or click an icon to log in:


			You are commenting using your WordPress.com account.
( Log Out / 
				Change )


			You are commenting using your Google account.
( Log Out / 
				Change )


			You are commenting using your Twitter account.
( Log Out / 
				Change )


			You are commenting using your Facebook account.
( Log Out / 
				Change )
 Notify me of new comments via email.
 Notify me of new posts via email.
Enter your email address to follow this blog and receive notifications of new posts by email.
