Last week we provided some initial analysis on recent attacks targeting organizations in the Middle East.
The attack has hallmarks of the Shamoon campaign of 2012.
We now have additional data related to the components used within the new campaign, which has three distinct components: dropper, wiper, and wiper driver.
The language of these three components—PKCS12 (wiper), PKCS7, and X509—is lang:9217, which translates to Yemeni Arabic.
We also see both 32- and 64-bit versions.
The malware spreads over the network using the IPC$ share and embedded administrator credentials from the targeted organization, so we can assume that the attackers already had a beachhead to gather these credentials from one of the samples.
The password was also very strong, another indicator that the attackers might have had network access to compromise passwords and accounts.
Indeed, our Foundstone team, which has conducted significant work on both campaigns, has confirmed individuals (not related to the attacks) who have shown off their technical prowess by publicizing the compromised credentials on public forums.
The malware tries to disable the user account control, verifies if it is connected with admin credentials, and drops the payload in the System32 folder.
Another run option is to use the AT command and schedule a job to execute the payload.
Wiping function
The wiper component was hardcoded to start Thursday, November 17 at 20:45, after the beginning of Saudi Arabia’s Friday holiday, when most employees have left and after the evening prayer time.
The wiper component verifies the date and extracts the wiper component to System32 using the same random names as generated by the Shamoon code from 2012.
The wiper has three options for deletion: F, E, and R. The F option wipes the data with the JPEG of the Syrian refugee boy Alan Kurdi lying drowned on the beach.
The E and R option wipe using random values.
Shamoon 1 used a JPEG of a burning US flag.
Also during the mass deletion, the wiper uses the Eldos RawDisk driver to change the system time to August 2012, probably to not allow the expiration of the trial period of the temporary license for the software.
We have found many similarities between the 2012 attack and this recent campaign.
There are a few alterations to the code and political themes, but overall we see a similar framework and process.
Detection
In cooperation with McAfee Labs we can confirm that all related samples of this attack are detected by the signature DistTrack!
[partial-hash].
The driver used for the wiper is legitimate software.
Thus this threat carries the on-screen warning Possibly Unwanted Program.
We will continue our analysis, particularly as our Foundstone team identifies additional indicators.
