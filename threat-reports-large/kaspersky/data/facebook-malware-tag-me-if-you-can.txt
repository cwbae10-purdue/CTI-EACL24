On the morning of 26th June, news of a phishing campaign hit the Israeli media.
Thousands of Facebook users complained that they had been infected by a virus through their accounts after they received a message from a Facebook friend claiming they had mentioned them in a comment.
Kaspersky Lab decided to investigate.
We quickly discovered that the message had in fact been initiated by attackers and unleashed a two-stage attack on recipients.
We also found that the attack was not confined to Israel, but was hitting targets worldwide.
The first stage of the attack started when the user clicked on the “mention”.
A malicious file seized control of their browsers, terminating their legitimate browser session and replacing it with a malicious one that included a tab to the legitimate Facebook login page.
This was designed to lure the victim back into the social network site.
Upon logging back into Facebook the victim’s session was hijacked in the background and a new file was downloaded.
This represented the second stage of the attack, as embedded in this file was an account-takeover script that included a privacy-settings changer, account-data extractor and other tools that could be used for further malicious activity, such as spam, identity theft and generating fraudulent ‘likes’ and ‘shares’.
Further, the malware infection loop began again as malicious notifications were sent to all the victim’s Facebook friends.
The Kaspersky Security Network (KSN) recorded almost ten thousand infection attempts around the globe in the space of just 48 hours.
Malicious JavaScript file spike hits thousands of victims
Facebook has now mitigated this threat and is blocking techniques used to spread malware from infected computers.
It says that it has not observed any further infection attempts.
Google has also removed at least one of the culprit extensions from the Chrome Web Store.
The most affected countries were Brazil, Poland, Peru, Colombia, Mexico, Ecuador, Greece, Portugal, Tunisia, Venezuela, Germany and, finally, Israel.
On a pie chart we can more easily see how the infection spread around the globe:
It’s worth mentioning that people using Windows-based computers to access Facebook were at the greatest risk.
Those using Windows OS phones could have been at risk too, although this is less likely.
Users of Android and iOS mobile devices were completely immune since the malware uses libraries which are not compatible with these mobile operating systems.
Malware downloaded from an Android device with invalid format error
The infection seemed to begin when victims received a notification of a Facebook “mention” that appeared to come from a friend:
This provided the attackers with a rabbit hole through which they could hijack the user’s Facebook session and permissions and send out malicious notifications to the victim’s Facebook friends.
During our investigation we found the script that was responsible for the delivery of the malicious notification.
This script was triggered when the user of a compromised machine attempted to login to Facebook via a malicious Chrome shortcut.
Clicking on the notification redirects the user to an empty post containing a link to Google Docs.
This link automatically downloads a JavaScript file called comment_27734045.jse and is a Trojan downloader.
