In February 2019, Unit 42 published a blog about the BabyShark malware family and the associated spear phishing campaigns targeting U.S. national think tanks.
Since that publication, malicious attacks leveraging BabyShark have continued through March and April 2019.
The attackers expanded targeting to the cryptocurrency industry, showing that those behind these attacks also have interests in financial gain.
While tracking the latest activities of the threat group, Unit 42 researchers were able to collect both the BabyShark malware’s server-side and client-side files, as well as two encoded secondary PE payload files that the malware installs on the victim hosts upon receiving an operator’s command.
By analyzing the files, we were able to further understand the overall multi-staging structure of the BabyShark malware and features, such as how it attempts to maintain operational security and supported remote administration commands.
Based on our research, it appears the malware author calls the encoded secondary payload “Cowboy” regardless of what malware family is delivered.
Our research shows the most recent malicious activities involving BabyShark malware appear to be carried out for two purposes:
Espionage on nuclear security and the Korean peninsula’s national security issues
Financial gain with focus on the cryptocurrency industry based on the decoy contents used in the samples, shown in Figure 1.
Xcryptocrash is an online cryptocurrency gambling game.
Figure 1.
Cryptocurrency related BabyShark malicious document decoy
We presume that the BabyShark malware toolset is shared among actors under the same umbrella or the same group has been assigned an additional mission.
In our analysis, we found BabyShark attacks were using KimJongRAT and PCRat as the encoded secondary payload and thus were the “Cowboys”.
BabyShark has a multi-stage infection chain with checks between each stage, as shown in Figure 2, to ensure only targeted hosts are advanced to the next stage before it finally beacons backs to the attacker.
Figure 2.
BabyShark malware overall structure
This is done by maintaining a list of denylisted IP addresses and computer names for those who have made suspicious access attempts, such as access with invalid parameters, to the server as a possible technique meant to make analysis harder.
The IP addresses and computer names in the denylist are written in base64 encoded format at [BASE_URI]/blackip.txt, shown in Figure 3.
Figure 3.
Denylisted IP addresses and computer names in blacktip.txt
When a new access attempt is made with data matching the denylist, the server will not proceed to the next stage and alerts the operator via a separate log file shown in Figure 4.
Figure 4.
Suspicious activity log report to operator
BabyShark’s C2 server also logs access to its base URI and redirects to http://go.microsoft.com/.
The purpose of this is likely to avoid its files being seen due to potential mis-configurations of the hosting web server.
if($ff=fopen(“resp_suspect”,”a”))
{
fwrite($ff, $date .
” ” .
$ip .
” suspected access ” .
$useragent .”\r\n”);
fclose($ff);
}
header(‘Location: http://go.microsoft.com/’);
exit;
The operator can issue VBS and PowerShell based commands to victim systems infected with BabyShark.
The remote commands we found from the C2 are in the below table, but BabyShark is not limited to these as the attacker can create more VBS or PowerShell command files.
VBS based remote commands:
