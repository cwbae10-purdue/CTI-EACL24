Throughout 2017 and 2018 Unit 42 has been tracking and observing a series of highly targeted attacks focused in South East Asia, building on our research into the KHRAT Trojan.
Based on the evidence, these attacks appear to be conducted by the same set of attackers using previously unknown malware families.
In addition, these attacks appear to be highly targeted in their distribution of the malware used, as well as the targets chosen.
Based on these factors, Unit 42 believes the attackers behind these attacks are conducting their campaigns for espionage purposes.
We believe this group is previously unidentified and therefore have we have dubbed it “RANCOR”.
The Rancor group’s attacks use two primary malware families which we describe in depth later in this blog and are naming DDKONG and PLAINTEE.
DDKONG is used throughout the campaign and PLAINTEE appears to be new addition to these attackers’ toolkit.
Countries Unit 42 has identified as targeted by Rancor with these malware families include, but are not limited to:
Singapore
Cambodia
We identified decoy files which indicate these attacks began with spear phishing messages but have not observed the actual messages.
These decoys contain details from public news articles focused primarily on political news and events.
Based on this, we believe the Rancor attackers were targeting political entities.
Additionally, these decoy documents are hosted on legitimate websites including a government website belonging to the Cambodia Government and in at least once case, Facebook.
The malware and infrastructure used in these attacks falls into two distinct clusters, which we are labeling A and B, that are linked through their use of the PLAINTEE malware and several “softer” linkages.
Linking the attacks Building on our previous research into KHRAT Trojan, we have been monitoring KHRAT command and control domains.
In February 2018, several KHRAT associated domains began resolving to the IP address 89.46.222.97.
We made this IP the center of our investigation.
Examining passive DNS (pDNS) records from PassiveTotal revealed several domain names associated with this IP that mimic popular technology companies.
One of these domains, facebook-apps.com, was identified in one of the malware samples associated with this IP address.
The following table depicts the two malware samples that are directly related to this IP address:
Digging in further, the malware family we later named “PLAINTEE” appears to be quite unique with only six samples present in our data set.
Apart from one sample (c35609822e6239934606a99cb3dbc925f4768f0b0654d6a2adc35eca473c505d), we were able to link all PLAINTEE samples together by the infrastructure they use.
The diagram in Figure 1 shows the samples, domains, IP addresses and e-mail addresses that we identified during our investigation (See Appendix B for more detail on these.)
There is a clear split between Cluster A and Cluster B, with no infrastructure overlap between the two.
Figure 1 – Diagram showing the split of PLAINTEE samples across the two clusters of activity.
Our Investigation into both clusters further showed that they were both involved in attacks targeting organizations in South East Asia.
Based on the use of the relatively unique PLAINTEE malware, the malware’s use of the same file paths on in each cluster, and the similar targeting, we have grouped these attacks together under the RANCOR campaign moniker.
Delivery & Loader mechanisms For many of the samples we’ve been unable to identify how they were delivered to end victims; however, in three cases we were able to locate the files used to deliver the Trojan, which we found merited more investigation and are briefly discussed below.
Cluster A Case 1: Delivery via document property macro – a789a282e0d65a050cccae66c56632245af1c8a589ace2ca5ca79572289fd483 In our research we found at least one attack against a company leveraging a Microsoft Office Excel document with an embedded macro to launch the malware.
Interestingly, the delivery document borrowed a technique which was publicized in late 2017 as being used by the Sofacy threat actors, embedding the main malicious code in a EXIF metadata property of the document.
By doing so, the main content of the macro itself (Figure 2) can be kept relatively simple, and the malicious’ codes small footprint can help enable evasion of automated detection mechanisms based on macro content.
Figure 2 – The entire contents of the macro
The ‘Company’ field in this case, contains the raw command that the attacker wishes to run, downloading and executing the next stage of the malware:
Cluster B Case 2: Delivery via HTA Loader – 1dc5966572e94afc2fbcf8e93e3382eef4e4d7b5bc02f24069c403a28fa6a458 In this case the attackers sent an HTML Application file (.hta) to targets most likely as an email attachment.
When opened and then executed, the key components of the HTA file downloads and executes further malware from a remote URLand loads a decoy image hosted externally (Figure 3).
Figure 3 – The decoy image loaded when the .HTA file is executed.
The decoy in Figure 3 strongly suggests the attackers were conducting an attack against a political entity in Cambodia.
The Cambodia National Rescue Party is a politically motivated opposition movement.
Case 3: Delivery via DLL Loader – 0bb20a9570a9b1e3a72203951268ffe83af6dcae7342a790fe195a2ef109d855 We identified three unique DLL loaders during this analysis.
The loaders are extremely simple with a single exported function and are responsible for executing a single command.
An exemplar command is given below:
