Introduction
Beginning in early 2018, Unit 42 observed a series of attacks using a previously unreported malware family, which we have named ‘NOKKI’.
The malware in question has ties to a previously reported malware family named KONNI, however, after careful consideration, we believe enough differences are present to introduce a different malware family name.
To reflect the close relationship with KONNI, we chose NOKKI, swapping KONNI’s Ns and Ks.
Because of code overlap found within both malware families, as well as infrastructure overlap, we believe the threat actors responsible for KONNI are very likely also responsible for NOKKI.
Previous reports stated it was likely KONNI had been in use for over three years in multiple campaigns with a heavy interest in the Korean peninsula and surrounding areas.
As of this writing, it is not certain if the KONNI or NOKKI operators are related to known adversary groups operating in the regions of interest, although there is evidence of a tenuous relationship with a group known as Reaper.
The latest activity leveraging the NOKKI payload likely targets politically-motivated victims in Eurasia and possibly Southeast Asia.
These attacks leverage compromised legitimate infrastructure for both delivery and command and control (C2).
These compromised servers are largely located within South Korea.
In total, we observed two waves of attacks spanning from early 2018 to at least July 2018 which we were able to cluster via the specific network protocol used for C2.
In addition, the decoy documents themselves wer both created and last modified by an author named zeus.
The zeus username is a recurring artifact witnessed in all of the discussed attacks in this report.
January 2018 Attack
The earliest observed attack delivering NOKKI took place in January 2018.
This attack leverages a Microsoft Windows executable file using a PDF icon in an attempt to trick the victim into launching the file.
The malware sample contains the properties seen in Table 1:
Table 1 January NOKKI properties
The malware is capable of collecting information on the victim machine, dropping, and executing a payload, as well as dropping and opening a decoy document.
The malware will collect data from the victim machine and write this information to LOCALAPPDATA%\MicroSoft Updatea\uplog.tmp.
The following information is collected from the victim:
IP Address
Hostname
Username
Drive Information
Operating System Information
Installed Programs
This specific function shares significant code overlap with the KONNI tool first discovered by Talos.
The NOKKI payload is written to %LOCALAPPDATA%\MicroSoft Updatea\svServiceUpdate.exe prior being executed in a new process.
Persistence is achieved by writing the file path to the HKCU\Software\Microsoft\Windows\CurrentVersion\Run\svstartup registry key.
After being executed and establishing persistence, NOKKI then connects to 101.129.1.104 for C2 communication via FTP.
This IP does not have a domain name resolution; however, WHOis shows the IP assigned to China Central Television.
The decoy document is written to the same file path as the initial dropper, however, the extension is renamed to .pdf and becomes a legitimate document.
Based on the decoy document contents and language, the attack may target
Cambodian speakers with an interest in Cambodian political matters.
Figure 1 shows the decoy document used for this sample:
Figure 1 Decoy document for b8120d5c9c2c889b37aa9e37514a3b4964c6e41296be216b327cdccd2e908311
April 2018 Attack
In early April 2018, another attack was observed delivering the NOKKI payload.
This attack leveraged a malicious executable with an .scr extension that had the original filename referring to the Russian Ministry of Foreign Affairs and its contents can be found online.
The file contains the properties as seen in Table 2:
Table 2 April NOKKI Properties
This sample contained the same PDB string within it as sample from January 2018.
Functionally, it was nearly identical in its behavior as the previous attack.
Unlike the previously witnessed attack that possibly targeted Cambodian language speakers with an interest in Cambodian political matters, the decoy document used in this attack is written Cyrillic and contains content related to Russian political matters.
Once the .scr file is executed, the NOKKI payload is installed onto the victim host which then connects to the IP resolving to a likely compromised but legitimate South Korean science and technology university website.
Figure 2 Decoy document for 9bf634ff0bc7c69ffceb75f9773c198944d907ba822c02c44c83e997b88eeabd
The content of the decoy document in Figure 2 is a publicly available.
Google Translate roughly translates to the following:
About the meeting of the State Secretary – Deputy Minister of Foreign Affairs of Russia GB Karasin and the Director of the Institute of Strategic and Interregional Studies under the President of Uzbekistan, VI Norov
A second sample was discovered in April 2018, also written Cyrillic and containing content related to Russian political matters.
This file had the following properties as seen in Table 3:
